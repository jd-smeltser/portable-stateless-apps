{
  "version": 1,
  "type": "app-bundle",
  "manifest": {
    "id": "counter",
    "name": "Counter",
    "description": "Simple counter demo app",
    "icon": "ðŸ”¢",
    "version": "1.0.0",
    "records": {
      "creates": ["counter"],
      "opens": ["counter"]
    }
  },
  "html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta name=\"theme-color\" content=\"#0a0a0a\">\n  <title>Counter</title>\n  <style>\n    :root {\n      --bg: #0a0a0a;\n      --surface: #141414;\n      --border: #262626;\n      --text: #e5e5e5;\n      --text-muted: #737373;\n      --accent: #3b82f6;\n    }\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n    html, body {\n      height: 100%;\n      background: var(--bg);\n      color: var(--text);\n      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;\n    }\n    #app {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding: 24px;\n    }\n    h1 { font-size: 1.5rem; margin-bottom: 32px; color: var(--text-muted); }\n    .counter {\n      font-size: 6rem;\n      font-weight: 700;\n      color: var(--accent);\n      margin-bottom: 32px;\n    }\n    .buttons { display: flex; gap: 16px; }\n    button {\n      width: 60px;\n      height: 60px;\n      font-size: 2rem;\n      background: var(--surface);\n      border: 1px solid var(--border);\n      border-radius: 12px;\n      color: var(--text);\n      cursor: pointer;\n    }\n    button:hover { background: var(--border); }\n    button:active { transform: scale(0.95); }\n    .save-status {\n      margin-top: 24px;\n      font-size: 0.8rem;\n      color: var(--text-muted);\n    }\n  </style>\n</head>\n<body>\n  <div id=\"app\">\n    <h1>Counter</h1>\n    <div class=\"counter\" id=\"count\">0</div>\n    <div class=\"buttons\">\n      <button id=\"dec\">-</button>\n      <button id=\"inc\">+</button>\n    </div>\n    <div class=\"save-status\" id=\"status\">Saved</div>\n  </div>\n  <script src=\"https://unpkg.com/lz-string@1.5.0/libs/lz-string.min.js\"></script>\n  <script type=\"module\">\n    import Registry from '/core/registry.js';\n    import Omnibar from '/core/omnibar.js';\n\n    let count = 0;\n    let recordId = null;\n    const countEl = document.getElementById('count');\n    const statusEl = document.getElementById('status');\n\n    // Initialize omnibar\n    Omnibar.init({\n      app: 'counter',\n      onCreate: (title) => createCounter(parseInt(title) || 0),\n      onSelect: (record) => {\n        if (record.type === 'counter') {\n          loadCounter(record.id);\n          return true;\n        }\n        return false;\n      }\n    });\n\n    function encodeState(state) {\n      return LZString.compressToEncodedURIComponent(JSON.stringify(state));\n    }\n\n    function decodeState(hash) {\n      try {\n        return JSON.parse(LZString.decompressFromEncodedURIComponent(hash));\n      } catch { return null; }\n    }\n\n    function createCounter(initialValue = 0) {\n      const ts = Date.now();\n      count = initialValue;\n      const state = { value: count, ts };\n      const url = window.location.pathname + '#' + encodeState(state);\n      const record = Registry.add('counter', url, {\n        meta: { title: `Counter: ${count}`, ts }\n      });\n      recordId = record.id;\n      render();\n      save();\n    }\n\n    function loadCounter(id) {\n      const record = Registry.get(id);\n      if (!record) return;\n      recordId = id;\n      const state = decodeState(record.url.split('#')[1]);\n      count = state?.value || 0;\n      render();\n    }\n\n    function save() {\n      if (!recordId) return;\n      const record = Registry.get(recordId);\n      const ts = record?.meta?.ts || Date.now();\n      const state = { value: count, ts };\n      const url = window.location.pathname + '#' + encodeState(state);\n      Registry.update(recordId, {\n        url,\n        meta: { title: `Counter: ${count}`, ts }\n      });\n      history.replaceState(null, '', url);\n      statusEl.textContent = 'Saved';\n    }\n\n    function render() {\n      countEl.textContent = count;\n    }\n\n    document.getElementById('inc').addEventListener('click', () => {\n      count++;\n      render();\n      save();\n    });\n\n    document.getElementById('dec').addEventListener('click', () => {\n      count--;\n      render();\n      save();\n    });\n\n    // Init: load from URL or create new\n    const hash = window.location.hash.slice(1);\n    if (hash) {\n      const state = decodeState(hash);\n      if (state) {\n        const counters = Registry.byType('counter');\n        const existing = counters.find(c => c.meta?.ts === state.ts);\n        if (existing) {\n          loadCounter(existing.id);\n        } else {\n          count = state.value || 0;\n          const ts = state.ts || Date.now();\n          const url = window.location.pathname + '#' + encodeState({ value: count, ts });\n          const record = Registry.add('counter', url, {\n            meta: { title: `Counter: ${count}`, ts }\n          });\n          recordId = record.id;\n          render();\n        }\n      }\n    } else {\n      const counters = Registry.byType('counter');\n      if (counters.length > 0) {\n        loadCounter(counters[0].id);\n      } else {\n        createCounter(0);\n      }\n    }\n  </script>\n</body>\n</html>",
  "recordTypes": {
    "counter": {
      "name": "Counter",
      "icon": "ðŸ”¢",
      "schema": { "value": "number", "ts": "number" }
    }
  }
}
